/* ============================================
   WAR OF THE RING - Digital Edition
   Dark Fantasy Theme
   ============================================ */

@import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=Cinzel+Decorative:wght@400;700;900&family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=Source+Sans+3:wght@300;400;600;700&display=swap');

:root {
    --bg-darkest: #0a0a0f;
    --bg-dark: #111118;
    --bg-mid: #1a1a24;
    --bg-card: #16161e;
    --bg-panel: #12121a;
    --bg-hover: #1e1e2a;

    --gold: #c9a84c;
    --gold-light: #e4c76a;
    --gold-dim: #8a7030;
    --gold-glow: rgba(201, 168, 76, 0.3);

    --text-primary: #e8e0d0;
    --text-secondary: #a09880;
    --text-dim: #6a6458;
    --text-bright: #f5f0e8;

    --gondor: #3a6fbf;
    --gondor-bg: rgba(58, 111, 191, 0.15);
    --rohan: #2a7a3a;
    --rohan-bg: rgba(42, 122, 58, 0.15);
    --north: #5a9abf;
    --north-bg: rgba(90, 154, 191, 0.15);
    --dwarves: #8a6a3a;
    --dwarves-bg: rgba(138, 106, 58, 0.15);
    --elves: #4aaa5a;
    --elves-bg: rgba(74, 170, 90, 0.15);
    --sauron: #bf3a3a;
    --sauron-bg: rgba(191, 58, 58, 0.15);
    --isengard: #bfaa3a;
    --isengard-bg: rgba(191, 170, 58, 0.15);
    --southrons: #bf7a3a;
    --southrons-bg: rgba(191, 122, 58, 0.15);

    --fp-color: #4a8abf;
    --fp-bg: rgba(74, 138, 191, 0.12);
    --fp-glow: rgba(74, 138, 191, 0.3);
    --shadow-color: #bf4a4a;
    --shadow-bg: rgba(191, 74, 74, 0.12);
    --shadow-glow: rgba(191, 74, 74, 0.3);

    --header-height: 48px;
    --sidebar-width: 320px;
    --panel-radius: 8px;
    --card-radius: 6px;
    --transition-fast: 150ms ease;
    --transition-med: 300ms ease;
}

*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

html, body {
    height: 100%;
    overflow: hidden;
    background: var(--bg-darkest);
    color: var(--text-primary);
    font-family: 'Source Sans 3', sans-serif;
    font-size: 14px;
    line-height: 1.5;
    -webkit-font-smoothing: antialiased;
}

::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg-dark); }
::-webkit-scrollbar-thumb { background: var(--gold-dim); border-radius: 3px; }

/* ── App Layout ── */
#app { display: flex; flex-direction: column; height: 100vh; width: 100vw; }

/* ── Setup Screen ── */
.setup-screen {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    height: 100vh; background: var(--bg-darkest); position: absolute; inset: 0; z-index: 500;
    transition: opacity 0.5s ease;
}

.setup-screen.hidden { opacity: 0; pointer-events: none; }

.setup-title {
    font-family: 'Cinzel Decorative', serif; font-size: 42px; color: var(--gold);
    text-shadow: 0 0 40px var(--gold-glow), 0 2px 10px rgba(0,0,0,0.5);
    margin-bottom: 4px; letter-spacing: 4px;
    animation: titleGlow 3s ease-in-out infinite alternate;
}

.setup-subtitle {
    font-family: 'Cormorant Garamond', serif; font-size: 18px; font-style: italic;
    color: var(--text-secondary); margin-bottom: 40px;
}

@keyframes titleGlow {
    from { text-shadow: 0 0 30px var(--gold-glow), 0 2px 10px rgba(0,0,0,0.5); }
    to { text-shadow: 0 0 60px var(--gold-glow), 0 0 80px rgba(201,168,76,0.15); }
}

.side-selection { display: flex; gap: 24px; margin-bottom: 32px; }

.side-option {
    width: 260px; padding: 28px 24px; border: 2px solid rgba(255,255,255,0.1);
    border-radius: 12px; text-align: center; cursor: pointer;
    transition: var(--transition-med); background: var(--bg-card);
}

.side-option:hover { transform: translateY(-4px); }
.side-option.fp:hover, .side-option.fp.selected {
    border-color: var(--fp-color); box-shadow: 0 8px 30px rgba(74,138,191,0.2); background: var(--fp-bg);
}
.side-option.shadow:hover, .side-option.shadow.selected {
    border-color: var(--shadow-color); box-shadow: 0 8px 30px rgba(191,74,74,0.2); background: var(--shadow-bg);
}

.side-option .side-icon { font-size: 48px; margin-bottom: 12px; }
.side-option .side-name { font-family: 'Cinzel', serif; font-size: 18px; font-weight: 700; margin-bottom: 6px; }
.side-option.fp .side-name { color: var(--fp-color); }
.side-option.shadow .side-name { color: var(--shadow-color); }
.side-option .side-desc { font-family: 'Cormorant Garamond', serif; font-size: 13px; color: var(--text-dim); font-style: italic; }

/* ── Header ── */
#header {
    height: var(--header-height); background: linear-gradient(180deg, var(--bg-mid) 0%, var(--bg-dark) 100%);
    border-bottom: 1px solid rgba(201,168,76,0.2); display: flex; align-items: center;
    justify-content: space-between; padding: 0 16px; flex-shrink: 0; z-index: 100;
}

#header .logo { font-family: 'Cinzel Decorative', serif; font-size: 16px; font-weight: 700; color: var(--gold); letter-spacing: 2px; }
#header .turn-info { font-family: 'Cinzel', serif; font-size: 12px; color: var(--text-secondary); display: flex; align-items: center; gap: 16px; }
.phase-badge {
    background: var(--gold-dim); color: var(--bg-darkest); padding: 2px 10px; border-radius: 3px;
    font-weight: 700; font-size: 10px; text-transform: uppercase; letter-spacing: 1px;
}
#header .controls { display: flex; gap: 8px; }

/* ── Main Content ── */
#main-content { display: flex; flex: 1; overflow: hidden; }

/* ── Sidebars ── */
#left-sidebar, #right-sidebar {
    width: var(--sidebar-width); background: var(--bg-panel);
    display: flex; flex-direction: column; overflow-y: auto; flex-shrink: 0;
}
#left-sidebar { border-right: 1px solid rgba(201,168,76,0.1); }
#right-sidebar { border-left: 1px solid rgba(201,168,76,0.1); }

/* ── Map Area ── */
#map-container {
    flex: 1; position: relative; overflow: hidden; background: var(--bg-darkest);
    background-image: radial-gradient(ellipse at 40% 50%, rgba(30,40,20,0.3) 0%, transparent 70%);
    cursor: grab;
}
#map-container:active { cursor: grabbing; }
#game-map { position: absolute; width: 1800px; height: 1200px; transform-origin: 0 0; }

/* Map connections SVG */
#map-connections { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
#map-connections line { stroke: rgba(255,255,255,0.05); stroke-width: 1; }

/* Map region nodes */
.map-region { position: absolute; cursor: pointer; transition: var(--transition-fast); z-index: 2; }

.region-dot {
    width: 18px; height: 18px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.2);
    background: rgba(20,20,30,0.85); transition: var(--transition-fast); position: relative;
}
.map-region:hover .region-dot { border-color: var(--gold); box-shadow: 0 0 12px var(--gold-glow); transform: scale(1.2); }
.map-region.selected .region-dot { border-color: var(--gold-light); box-shadow: 0 0 20px var(--gold-glow); background: rgba(201,168,76,0.3); }

.region-label {
    position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
    font-family: 'Cormorant Garamond', serif; font-size: 9px; color: var(--text-dim);
    white-space: nowrap; pointer-events: none; text-shadow: 0 1px 4px rgba(0,0,0,0.9);
}
.map-region:hover .region-label { color: var(--text-primary); font-weight: 600; }

/* Settlement sizes */
.region-dot.stronghold { width: 26px; height: 26px; border-width: 3px; }
.region-dot.city { width: 22px; height: 22px; }
.region-dot.town { width: 16px; height: 16px; }
.region-dot.fortification { border-radius: 4px; width: 18px; height: 18px; }

/* Nation colors on regions */
.region-dot.gondor-r { border-color: var(--gondor); }
.region-dot.rohan-r { border-color: var(--rohan); }
.region-dot.north-r { border-color: var(--north); }
.region-dot.dwarves-r { border-color: var(--dwarves); }
.region-dot.elves-r { border-color: var(--elves); }
.region-dot.sauron-r { border-color: var(--sauron); }
.region-dot.isengard-r { border-color: var(--isengard); }
.region-dot.southrons-r { border-color: var(--southrons); }

/* Army pips on map */
.map-armies {
    position: absolute; display: flex; gap: 1px; top: -10px; left: 22px; z-index: 3;
    flex-wrap: wrap; max-width: 50px;
}
.army-pip {
    width: 7px; height: 7px; border-radius: 1px; border: 1px solid rgba(255,255,255,0.3);
}
.army-pip.fp-r { background: var(--fp-color); }
.army-pip.fp-e { background: var(--fp-color); border-color: var(--gold); }
.army-pip.sp-r { background: var(--shadow-color); }
.army-pip.sp-e { background: var(--shadow-color); border-color: var(--gold); }
.army-pip.leader { background: #aaa; border-radius: 50%; }
.army-pip.nazgul { background: #666; border-radius: 50%; border-color: var(--shadow-color); }
.army-pip.character { background: var(--gold-dim); border-radius: 50%; border-color: var(--gold); }

/* Fellowship marker on map */
.fellowship-marker {
    position: absolute; z-index: 10; width: 28px; height: 28px; border-radius: 50%;
    background: radial-gradient(circle, rgba(201,168,76,0.6), rgba(201,168,76,0.1));
    border: 2px solid var(--gold); box-shadow: 0 0 16px var(--gold-glow);
    display: flex; align-items: center; justify-content: center; font-size: 14px;
    cursor: pointer; transition: var(--transition-med);
    animation: fellowshipPulse 2s ease-in-out infinite;
}

@keyframes fellowshipPulse {
    0%, 100% { box-shadow: 0 0 16px var(--gold-glow); }
    50% { box-shadow: 0 0 28px var(--gold-glow), 0 0 40px rgba(201,168,76,0.1); }
}

/* ── Panels ── */
.panel {
    margin: 6px 8px; background: var(--bg-card); border: 1px solid rgba(201,168,76,0.08);
    border-radius: var(--panel-radius); overflow: hidden;
}
.panel-header {
    font-family: 'Cinzel', serif; font-size: 10px; font-weight: 700; color: var(--gold);
    text-transform: uppercase; letter-spacing: 1.5px; padding: 7px 10px;
    background: rgba(201,168,76,0.04); border-bottom: 1px solid rgba(201,168,76,0.08);
    display: flex; align-items: center; justify-content: space-between;
}
.panel-body { padding: 8px 10px; }

/* ── Political Track ── */
.political-track { display: flex; flex-direction: column; gap: 2px; }
.political-step {
    display: flex; align-items: center; gap: 4px; padding: 2px 4px; border-radius: 3px;
    font-size: 10px; color: var(--text-dim);
}
.political-step.at-war {
    background: rgba(191,58,58,0.1); border: 1px solid rgba(191,58,58,0.2); font-weight: 600;
}
.political-step .step-label { width: 50px; font-family: 'Cinzel', serif; font-size: 9px; }
.political-step .nations-in-step { display: flex; gap: 3px; flex-wrap: wrap; }

.nation-token {
    display: inline-flex; align-items: center; gap: 2px; padding: 1px 5px;
    border-radius: 3px; font-size: 9px; font-weight: 600; border: 1px solid;
    cursor: pointer; transition: var(--transition-fast);
}
.nation-token:hover { filter: brightness(1.3); }
.nation-token.gondor { background: var(--gondor-bg); border-color: var(--gondor); color: var(--gondor); }
.nation-token.rohan { background: var(--rohan-bg); border-color: var(--rohan); color: var(--rohan); }
.nation-token.north { background: var(--north-bg); border-color: var(--north); color: var(--north); }
.nation-token.dwarves { background: var(--dwarves-bg); border-color: var(--dwarves); color: var(--dwarves); }
.nation-token.elves { background: var(--elves-bg); border-color: var(--elves); color: var(--elves); }
.nation-token.sauron { background: var(--sauron-bg); border-color: var(--sauron); color: var(--sauron); }
.nation-token.isengard { background: var(--isengard-bg); border-color: var(--isengard); color: var(--isengard); }
.nation-token.southrons { background: var(--southrons-bg); border-color: var(--southrons); color: var(--southrons); }

.nation-token .status-dot { width: 5px; height: 5px; border-radius: 50%; }
.nation-token .status-dot.passive { background: var(--text-dim); opacity: 0.5; }
.nation-token .status-dot.active { background: currentColor; }

/* ── Fellowship Track ── */
.track-row { display: flex; align-items: center; gap: 4px; margin-bottom: 4px; }
.track-row .track-label { font-family: 'Cinzel', serif; font-size: 9px; color: var(--text-dim); width: 65px; text-transform: uppercase; letter-spacing: 0.5px; }
.track-steps { display: flex; gap: 2px; flex: 1; }
.track-step {
    width: 20px; height: 20px; border-radius: 3px; background: var(--bg-mid);
    border: 1px solid rgba(255,255,255,0.08); display: flex; align-items: center;
    justify-content: center; font-size: 8px; color: var(--text-dim);
}
.track-step.active { border-color: var(--gold); background: rgba(201,168,76,0.15); color: var(--gold); box-shadow: 0 0 6px var(--gold-glow); }
.track-step.corruption { border-color: var(--shadow-color); background: rgba(191,74,74,0.15); color: var(--shadow-color); }
.track-step.mordor-step { background: rgba(191,58,58,0.08); border-color: rgba(191,58,58,0.2); }

/* ── Action Dice ── */
.dice-area { display: flex; flex-wrap: wrap; gap: 5px; padding: 2px 0; }

.action-die {
    width: 36px; height: 36px; border-radius: 5px; display: flex; align-items: center;
    justify-content: center; font-size: 16px; cursor: pointer; transition: var(--transition-fast);
    border: 2px solid; position: relative;
}
.action-die.fp { background: rgba(74,138,191,0.12); border-color: rgba(74,138,191,0.35); color: var(--fp-color); }
.action-die.shadow { background: rgba(191,74,74,0.12); border-color: rgba(191,74,74,0.35); color: var(--shadow-color); }
.action-die:hover { transform: scale(1.1); filter: brightness(1.2); }
.action-die.used { opacity: 0.25; pointer-events: none; }
.action-die.in-hunt { border-style: dashed; opacity: 0.5; }

/* ── Companions ── */
.companions-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 4px; }
.companion-card {
    background: var(--bg-mid); border: 1px solid rgba(74,138,191,0.15); border-radius: 4px;
    padding: 4px 6px; cursor: pointer; transition: var(--transition-fast);
}
.companion-card:hover { border-color: var(--fp-color); background: var(--bg-hover); }
.companion-card.in-fellowship { border-left: 3px solid var(--gold); }
.companion-card.separated { border-left: 3px solid var(--fp-color); opacity: 0.75; }
.companion-card.eliminated { opacity: 0.25; text-decoration: line-through; }
.companion-card .comp-name { font-family: 'Cinzel', serif; font-size: 9px; font-weight: 700; color: var(--text-bright); }
.companion-card .comp-info { font-size: 8px; color: var(--text-dim); }

/* ── VP Display ── */
.vp-display { display: flex; justify-content: space-between; align-items: center; }
.vp-side { text-align: center; flex: 1; }
.vp-side .vp-number { font-family: 'Cinzel Decorative', serif; font-size: 26px; font-weight: 900; }
.vp-side.fp .vp-number { color: var(--fp-color); }
.vp-side.shadow .vp-number { color: var(--shadow-color); }
.vp-side .vp-label { font-size: 8px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-dim); }
.vp-divider { width: 1px; height: 36px; background: rgba(255,255,255,0.1); }

/* ── Hunt Box ── */
.hunt-box-display { display: flex; gap: 4px; flex-wrap: wrap; align-items: center; }
.hunt-slot {
    width: 24px; height: 24px; border: 1px dashed rgba(191,74,74,0.3); border-radius: 3px;
    display: flex; align-items: center; justify-content: center; font-size: 12px;
}
.hunt-slot.filled { background: rgba(191,74,74,0.15); border-style: solid; }

/* ── Game Log ── */
.game-log { font-size: 11px; color: var(--text-dim); max-height: 160px; overflow-y: auto; display: flex; flex-direction: column; gap: 1px; }
.log-entry { padding: 2px 6px; border-left: 2px solid transparent; line-height: 1.3; }
.log-entry.fp-action { border-left-color: var(--fp-color); }
.log-entry.shadow-action { border-left-color: var(--shadow-color); }
.log-entry.system { border-left-color: var(--gold-dim); color: var(--text-secondary); }

/* ── Buttons ── */
.btn {
    font-family: 'Cinzel', serif; font-size: 11px; font-weight: 700; letter-spacing: 1px;
    text-transform: uppercase; padding: 6px 14px; border: 1px solid; border-radius: 4px;
    cursor: pointer; transition: var(--transition-fast); background: transparent;
}
.btn-gold { border-color: var(--gold); color: var(--gold); }
.btn-gold:hover { background: rgba(201,168,76,0.15); box-shadow: 0 0 12px var(--gold-glow); }
.btn-fp { border-color: var(--fp-color); color: var(--fp-color); }
.btn-fp:hover { background: var(--fp-bg); }
.btn-shadow { border-color: var(--shadow-color); color: var(--shadow-color); }
.btn-shadow:hover { background: var(--shadow-bg); }
.btn-sm { font-size: 9px; padding: 3px 8px; }

/* ── Map Controls ── */
.map-controls {
    position: absolute; bottom: 12px; right: 12px; display: flex; flex-direction: column;
    gap: 4px; z-index: 50;
}
.map-controls .btn { width: 32px; height: 32px; padding: 0; display: flex; align-items: center; justify-content: center; font-size: 16px; background: var(--bg-card); }

/* ── Tab Bar ── */
.tab-bar { display: flex; border-bottom: 1px solid rgba(201,168,76,0.1); }
.tab-btn {
    flex: 1; padding: 6px 4px; font-family: 'Cinzel', serif; font-size: 9px; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-dim); background: transparent;
    border: none; cursor: pointer; transition: var(--transition-fast); border-bottom: 2px solid transparent;
}
.tab-btn:hover { color: var(--text-secondary); }
.tab-btn.active { color: var(--gold); border-bottom-color: var(--gold); }
.tab-content { display: none; }
.tab-content.active { display: block; }

/* ── Region Detail Panel ── */
.region-detail .region-name { font-family: 'Cinzel', serif; font-size: 14px; font-weight: 700; color: var(--gold); }
.region-detail .region-meta { font-size: 10px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
.army-unit-row { display: flex; align-items: center; gap: 6px; font-size: 11px; padding: 2px 4px; border-radius: 3px; background: var(--bg-mid); margin-bottom: 2px; }
.army-unit-row .unit-count { font-weight: 700; min-width: 16px; text-align: center; }

/* ── Modal ── */
.modal-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px);
    display: flex; align-items: center; justify-content: center; z-index: 1000;
    opacity: 0; pointer-events: none; transition: var(--transition-med);
}
.modal-overlay.active { opacity: 1; pointer-events: all; }
.modal {
    background: var(--bg-dark); border: 1px solid rgba(201,168,76,0.3); border-radius: 12px;
    max-width: 700px; width: 90%; max-height: 85vh; overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0,0,0,0.6), 0 0 30px var(--gold-glow);
}
.modal-header { font-family: 'Cinzel Decorative', serif; font-size: 20px; color: var(--gold); padding: 20px 24px 12px; text-align: center; }
.modal-body { padding: 12px 24px 24px; }
.modal-footer { padding: 12px 24px 20px; display: flex; justify-content: center; gap: 12px; }

/* ── Animations ── */
@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
@keyframes diceRoll { 0% { transform: rotate(0) scale(1); } 50% { transform: rotate(180deg) scale(1.1); } 100% { transform: rotate(360deg) scale(1); } }
.fade-in { animation: fadeIn 0.3s ease forwards; }
.dice-rolling { animation: diceRoll 0.4s ease-in-out; }

@media (max-width: 1200px) { :root { --sidebar-width: 260px; } }
@media (max-width: 900px) { #left-sidebar, #right-sidebar { display: none; } }
